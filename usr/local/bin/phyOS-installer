#!/bin/bash


make_partition() {
    sed -e 's/\s*\([\+0-9a-zA-Z]*\).*/\1/' << EOF | fdisk ${1}
      o # clear the in memory partition table
      n # new partition
      p # primary partition
      1 # partition number 1
        # default - start at beginning of disk
      +100M # 100 MB boot parttion
      n # new partition
      p # primary partition
      2 # partion number 2
        # default, start immediately after preceding partition
        # default, extend partition to end of disk
      a # make a partition bootable
      1 # bootable partition is partition 1 -- /dev/sda1
      p # print the in-memory partition table
      w # write the partition table
      q # and we're done
EOF
}

disks=$(lsblk -r | grep "disk\|part" | awk '{print $1}')

for d in $disks; do
    sudo mount /dev/$d /mnt &>/dev/null
    [[ $(mount | grep mnt) ]] && printf "$d: "
    df -h | grep -w "/mnt" | awk '{printf $(NF-2); print FREE}'
    sudo umount /mnt &> /dev/null
    # block_size=$(sudo dumpe2fs  -h /dev/$d | grep "Block size" | awk '{print $NF}')
    # block_count=$(sudo dumpe2fs -h /dev/$d | grep "Free blocks" | awk '{print $NF}')
    # python -c "import sys; print(float(sys.argv[1]) * float(sys.argv[2]) / 2**10)" $block_size $block_count
done
