#!/bin/bash

tput setaf 42
echo "This installer only supports automatic partitioning and lvm2 installation."
echo "If you want older features, please install the other version."
echo "Traditional partitioning wont be available in this iso."
echo "Do you want luks2 encryption?"
tput setaf 1
echo "If it is a laptop, consider using it. Anyone with a live usb can get in your computer in 2 minutes if there is no encryption."
tput setaf 42
echo "Press 'y' or 'yes' for encryption."
echo "#!/bin/bash" > /tmp/phyinstall.conf
chmod +x /tmp/phyinstall.conf
read is_encrypt
echo "Do you want a swap space? Choose one of the options below: "
swap=$(gum choose "None" "1G" "2G" "3G" "4G" "5G" "8G" "16G" "32G" "48G")

if [[ $is_encrypt = "y" ]] || [[ $is_encrypt = "yes" ]]; then
    while true; do
        pass=$(gum input --password --placeholder "Please enter encryption password: ")
        pass2=$(gum input --password --placeholder "Please confirm encryption password: ")
        if [[ ! -z $pass ]] && [[ $pass = $pass2 ]]; then
            break
        fi
        echo
        echo "Password's dont match. Please try again."
    done

    echo "Password set succesfully."
    echo "pass=$pass" >> /tmp/phyinstall.conf
    echo "is_encrypt=true" >> /tmp/phyinstall.conf
    echo "lvm_device=phyoscrypt" >> /tmp/phyinstall.conf
else
    sudo cp -f /etc/calamares/modules/partition-noluks2.conf /etc/calamares/modules/partition.conf
    echo "is_encrypt=false" >> /tmp/phyinstall.conf
    echo "lvm_device=phyos" >> /tmp/phyinstall.conf
fi
echo "swap=$swap" >> /tmp/phyinstall.conf
phyOS-welcome-app & disown
