#!/bin/bash
pacman-key --init
pacman-key --populate archlinux
pacman-key --populate chaotic
pacman-key --populate phyOS
cp -f /usr/local/share/phyOS/mkinitcpio.d/linux.ply-encrypt-lvm.preset /etc/mkinitcpio.d/linux.preset
cryptdevice=$(lsblk -r | grep -B1 -w 'crypt /' | awk 'NR==1 {print $1}' | xargs -I '%' sudo cryptsetup luksUUID /dev/%)
sed -i "36s/.*/cryptdevice=UUID=$cryptdevice:root/" /usr/lib/initcpio/hooks/phy-encrypt
sed -i "36s/.*/cryptdevice=UUID=$cryptdevice:root/" /usr/lib/initcpio/hooks/phy-ply-encrypt
